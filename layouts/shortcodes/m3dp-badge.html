{{/*
  M3DP Badge Shortcode
  
  Usage:
    {{< m3dp-badge type="calculator" href="/tools/calculator/" >}}Calculator{{< /m3dp-badge >}}
    {{< m3dp-badge type="youtube" href="https://youtube.com/..." size="lg" >}}Watch Video{{< /m3dp-badge >}}
  
  Parameters:
    - type (required): calculator, app, youtube, email, support
    - href (optional): Link URL (if omitted, renders as span)
    - size (optional): sm, lg (defaults to base)
    - icon (optional): HTML/SVG icon to display before text
    - location (optional): GA4 location context (defaults to page path)
    - target (optional): Link target attribute
    - rel (optional): Link rel attribute
*/}}

{{- $type := .Get "type" | default "calculator" -}}
{{- $href := .Get "href" -}}
{{- $size := .Get "size" -}}
{{- $icon := .Get "icon" -}}
{{- $location := .Get "location" | default .Page.RelPermalink -}}
{{- $target := .Get "target" -}}
{{- $rel := .Get "rel" -}}
{{- $label := .Inner | plainify | htmlUnescape -}}

{{- $classes := slice "m3dp-badge" -}}
{{- $classes = $classes | append (printf "m3dp-badge--%s" $type) -}}
{{- if $size -}}
  {{- $classes = $classes | append (printf "m3dp-badge--%s" $size) -}}
{{- end -}}

{{- if $href -}}
  <a href="{{ $href | safeURL }}" 
     class="{{ delimit $classes " " }}"
     data-location="{{ $location }}"
     {{- if $target }} target="{{ $target }}"{{ end }}
     {{- if $rel }} rel="{{ $rel }}"{{ end }}
     onclick="if (typeof trackCtaClick === 'function') { trackCtaClick('{{ $type }}', '{{ $label }}', '{{ $location }}'); }">
    {{- if $icon -}}
      <span class="m3dp-badge__icon">{{ $icon | safeHTML }}</span>
    {{- end -}}
    <span class="m3dp-badge__label">{{ $label }}</span>
  </a>
{{- else -}}
  <span class="{{ delimit $classes " " }}"
        data-location="{{ $location }}">
    {{- if $icon -}}
      <span class="m3dp-badge__icon">{{ $icon | safeHTML }}</span>
    {{- end -}}
    <span class="m3dp-badge__label">{{ $label }}</span>
  </span>
{{- end -}}
